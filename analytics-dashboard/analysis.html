<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analysis - Analytics Dashboard</title>

  <!-- Technology Stack: Modern + Consistent -->

  <!-- TailwindCSS for modern styling (from inquiry.html) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Main dashboard styles for consistency (from analyze.html) -->
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/responsive.css">

  <!-- Inter font for consistency -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="assets/icons/favicon.ico">

  <!-- Advanced Dependencies (from inquiry.html) -->
  <script src="assets/vendor/echarts.min.js"></script>
  <script src="assets/js/data/mock-data-generator.js"></script>
  <script src="assets/js/services/api-service.js"></script>
  <script src="assets/js/nomodule/data.mock.simple.js"></script>
  <script src="assets/js/config/kpi-drilldown.js"></script>
  <script src="assets/js/nomodule/renderers.js"></script>

  <!-- Modern data grid (best of both) -->
  <script src="assets/js/modern/data-grid-api.js"></script>

  <!-- Custom styles for unified experience -->
  <style>
    /* Unified styling combining best patterns */
    .unified-header {
      background: var(--white);
      border-bottom: 1px solid var(--light-gray);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .header-nav-section {
      background: var(--primary-navy);
      color: var(--white);
      padding: var(--space-sm) 0;
    }

    .header-controls-section {
      background: var(--white);
      padding: var(--space-md) 0;
      border-bottom: 1px solid var(--light-gray);
    }

    .analysis-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: var(--space-lg);
    }

    .filter-panels-container {
      display: grid;
      grid-template-columns: 1fr 2fr 1fr;
      gap: var(--space-lg);
      margin-bottom: var(--space-xl);
    }

    .data-view-container {
      background: var(--white);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      overflow: hidden;
    }

    .view-header {
      background: var(--primary-navy);
      color: var(--white);
      padding: var(--space-md);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    /* Responsive design */
    @media (max-width: 1024px) {
      .filter-panels-container {
        grid-template-columns: 1fr;
        gap: var(--space-md);
      }
    }
  </style>
</head>
<body class="bg-gray-50">
  <div id="app" class="min-h-screen">

    <!-- Phase 2: Unified Header with Navigation + Controls -->
    <header class="unified-header">

      <!-- Navigation Section (from analyze.html pattern) -->
      <div class="header-nav-section">
        <div class="container mx-auto px-4">
          <div class="flex items-center justify-between">
            <div class="title-container">
              <h1 class="text-xl font-bold">Analytics Dashboard</h1>
            </div>
            <nav class="main-nav">
              <ul class="nav-list flex space-x-6">
                <li><a href="index.html" class="nav-item text-white hover:text-blue-200">Overview</a></li>
                <li><a href="analysis.html" class="nav-item text-white font-semibold">Analysis</a></li>
                <li><a href="reports.html" class="nav-item text-white hover:text-blue-200">Reports</a></li>
              </ul>
            </nav>
          </div>
        </div>
      </div>

      <!-- Controls Section (enhanced from inquiry.html) -->
      <div class="header-controls-section">
        <div class="container mx-auto px-4">
          <div class="flex items-center justify-between flex-wrap gap-4">

            <!-- Context Info -->
            <div class="week-context">
              <span class="text-sm text-gray-600" id="week-status">Week 36: Sep 18-24, 2025 (Day 5 of 7)</span>
            </div>

            <!-- Quick Filters -->
            <div class="flex items-center space-x-4">
              <div class="filter-group">
                <label class="text-xs font-semibold text-gray-600 uppercase tracking-wide">Week:</label>
                <select id="week-select" class="px-3 py-1 border rounded text-sm">
                  <option value="w36">Week 36: Sep 18-24, 2025</option>
                  <option value="w35">Week 35: Sep 11-17, 2025</option>
                  <option value="w34">Week 34: Sep 4-10, 2025</option>
                </select>
              </div>

              <div class="filter-group">
                <label class="text-xs font-semibold text-gray-600 uppercase tracking-wide">Version:</label>
                <select id="version-select" class="px-3 py-1 border rounded text-sm">
                  <option value="all">All Versions</option>
                  <option value="v1">Version A</option>
                  <option value="v2">Version B</option>
                </select>
              </div>

              <div class="filter-group">
                <label class="text-xs font-semibold text-gray-600 uppercase tracking-wide">Store:</label>
                <select id="store-select" class="px-3 py-1 border rounded text-sm">
                  <option value="all">All Stores</option>
                  <option value="miami">Miami Lakes</option>
                  <option value="hialeah">Hialeah</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content Area -->
    <main class="analysis-container">

      <!-- Drill-down Context Banner (from inquiry.html) -->
      <div id="drill-down-context" class="hidden mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
            </svg>
            <div>
              <span class="text-sm font-medium text-blue-900">Analyzing:</span>
              <span class="text-sm text-blue-800 ml-1" id="context-description">—</span>
            </div>
          </div>
          <button id="reset-context" class="text-sm text-blue-600 hover:text-blue-800 font-medium">
            ← Back to Overview
          </button>
        </div>
      </div>

      <!-- Phase 4: Unified Filter Panels -->
      <div class="filter-panels-container">

        <!-- Analysis Approach Panel (from inquiry.html) -->
        <div class="card bg-white rounded-lg shadow-sm border">
          <div class="card-header bg-gray-50 px-4 py-3 border-b">
            <h3 class="font-semibold text-gray-900">Analysis Approach</h3>
          </div>
          <div class="card-body p-4">
            <div class="space-y-3">
              <div>
                <label class="text-xs font-semibold text-gray-600 uppercase tracking-wide">Scope:</label>
                <select id="scope-select" class="w-full mt-1 px-3 py-2 border rounded">
                  <option value="promotion">Promotion</option>
                  <option value="category">Category</option>
                  <option value="store">Store</option>
                </select>
              </div>
              <div>
                <label class="text-xs font-semibold text-gray-600 uppercase tracking-wide">Lens:</label>
                <select id="lens-select" class="w-full mt-1 px-3 py-2 border rounded">
                  <option value="engagement">Engagement</option>
                  <option value="traffic">Traffic</option>
                  <option value="performance">Performance</option>
                </select>
              </div>
              <div>
                <label class="text-xs font-semibold text-gray-600 uppercase tracking-wide">Metric:</label>
                <select id="metric-select" class="w-full mt-1 px-3 py-2 border rounded">
                  <option value="composite">Composite Score</option>
                  <option value="engagement_score">Engagement Score</option>
                  <option value="click_rate">Click Rate</option>
                  <option value="atl_rate">Add-to-List Rate</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <!-- Content Filters Panel (enhanced from inquiry.html) -->
        <div class="card bg-white rounded-lg shadow-sm border">
          <div class="card-header bg-gray-50 px-4 py-3 border-b">
            <h3 class="font-semibold text-gray-900">Content Filters</h3>
          </div>
          <div class="card-body p-4">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="text-xs font-semibold text-gray-600 uppercase tracking-wide">Category:</label>
                <select id="category-filter" class="w-full mt-1 px-3 py-2 border rounded">
                  <option value="">All Categories</option>
                  <option value="featured">Featured</option>
                  <option value="farm-fresh">Farm Fresh</option>
                  <option value="meat-seafood">Meat & Seafood</option>
                  <option value="beverages">Beverages</option>
                </select>
              </div>
              <div>
                <label class="text-xs font-semibold text-gray-600 uppercase tracking-wide">Deal Type:</label>
                <select id="deal-type-filter" class="w-full mt-1 px-3 py-2 border rounded">
                  <option value="">All Deal Types</option>
                  <option value="bogo">Buy One Get One</option>
                  <option value="percent-off">% Off</option>
                  <option value="price-drop">Price Drop</option>
                </select>
              </div>
              <div>
                <label class="text-xs font-semibold text-gray-600 uppercase tracking-wide">Card Size:</label>
                <select id="size-filter" class="w-full mt-1 px-3 py-2 border rounded">
                  <option value="">All Sizes</option>
                  <option value="1x1">1x1</option>
                  <option value="2x1">2x1</option>
                  <option value="3x2">3x2</option>
                </select>
              </div>
              <div>
                <label class="text-xs font-semibold text-gray-600 uppercase tracking-wide">Position:</label>
                <select id="position-filter" class="w-full mt-1 px-3 py-2 border rounded">
                  <option value="">All Positions</option>
                  <option value="top">Top</option>
                  <option value="upper-mid">Upper Mid</option>
                  <option value="lower-mid">Lower Mid</option>
                  <option value="bottom">Bottom</option>
                </select>
              </div>
            </div>

            <!-- Search Filter -->
            <div class="mt-4">
              <label class="text-xs font-semibold text-gray-600 uppercase tracking-wide">Search:</label>
              <input
                type="text"
                id="search-filter"
                placeholder="Search promotions..."
                class="w-full mt-1 px-3 py-2 border rounded"
              >
            </div>
          </div>
        </div>

        <!-- Quick Actions Panel (from analyze.html) -->
        <div class="card bg-white rounded-lg shadow-sm border">
          <div class="card-header bg-gray-50 px-4 py-3 border-b">
            <h3 class="font-semibold text-gray-900">Quick Actions</h3>
          </div>
          <div class="card-body p-4">
            <div class="space-y-3">
              <button class="w-full px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm font-medium">
                Apply Filters
              </button>
              <button class="w-full px-4 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-50 text-sm font-medium">
                Reset All
              </button>
              <button class="w-full px-4 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-50 text-sm font-medium">
                Export CSV
              </button>
              <button class="w-full px-4 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-50 text-sm font-medium">
                Save View
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Phase 3: Unified Data Grid Container -->
      <div class="data-view-container">
        <div class="view-header">
          <h2 class="text-lg font-semibold">Promotion Analysis</h2>
          <div class="flex items-center space-x-4">
            <span class="text-sm opacity-90" id="results-count">Loading...</span>
            <div class="flex items-center space-x-2">
              <label class="text-sm opacity-90">View:</label>
              <select id="view-mode" class="px-2 py-1 bg-white text-gray-900 rounded text-sm">
                <option value="grid">Data Grid</option>
                <option value="chart">Chart View</option>
                <option value="summary">Summary</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Data Grid Content Area -->
        <div id="data-grid-container" class="p-4">
          <!-- Modern data grid will be rendered here -->
          <div id="grid-placeholder" class="text-center py-12 text-gray-500">
            <div class="animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-4"></div>
            <p>Loading promotion data...</p>
          </div>
        </div>
      </div>

    </main>
  </div>

  <!-- Phase 3: Advanced JavaScript Integration -->
  <script src="assets/js/nomodule/charts.js"></script>
  <script src="assets/js/nomodule/main.nomodule.js"></script>
  <script src="assets/js/services/inquiry-state.js"></script>

  <!-- Unified Application Controller -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      console.log('🚀 Initializing Unified Analysis Page...');

      // Initialize the modern data grid with unified configuration
      const analysisApp = new DataGridApp();

      // Set up event listeners for all filter controls
      setupUnifiedFilters(analysisApp);

      // Initialize with default view
      analysisApp.loadData();

      console.log('✅ Analysis page ready');
    });

    function setupUnifiedFilters(app) {
      // Week selector
      document.getElementById('week-select')?.addEventListener('change', (e) => {
        app.setState({ week: e.target.value });
      });

      // Analysis approach filters
      document.getElementById('scope-select')?.addEventListener('change', (e) => {
        app.setState({ scope: e.target.value });
      });

      document.getElementById('lens-select')?.addEventListener('change', (e) => {
        app.setState({ lens: e.target.value });
      });

      document.getElementById('metric-select')?.addEventListener('change', (e) => {
        app.setState({ metric: e.target.value });
      });

      // Content filters
      ['category', 'deal-type', 'size', 'position'].forEach(filterType => {
        const element = document.getElementById(`${filterType}-filter`);
        if (element) {
          element.addEventListener('change', (e) => {
            app.applyContentFilter(filterType, e.target.value);
          });
        }
      });

      // Search filter
      const searchFilter = document.getElementById('search-filter');
      if (searchFilter) {
        searchFilter.addEventListener('input', (e) => {
          app.applySearch(e.target.value);
        });
      }

      // View mode selector
      document.getElementById('view-mode')?.addEventListener('change', (e) => {
        app.switchView(e.target.value);
      });
    }
  </script>

</body>
</html>