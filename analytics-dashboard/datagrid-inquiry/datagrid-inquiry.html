<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Datagrid Inquiry - Analytics Dashboard</title>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/responsive.css">
    <link rel="stylesheet" href="../components/context-bar/context-bar-v2.styles.css">
    <link rel="stylesheet" href="../components/context-bar/simple-context-bar.css">
    <link rel="stylesheet" href="styles.css">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../assets/icons/favicon.ico">

    <!-- Preload critical resources -->
    <link rel="preload" href="../mock-data/004-data-extended.js" as="script">
    <link rel="preload" href="datagrid.js" as="script">
</head>
<body>
    <!-- Simplified header -->
    <header class="dashboard-header page-header" id="app-header">
        <div class="header-container">
            <div class="header-left">
                <div class="title-container">
                    <h1>Analytics Dashboard</h1>
                </div>
            </div>
        </div>

        <!-- Main Navigation -->
        <nav class="main-nav">
            <ul class="nav-list">
                <li><a href="../index.html" class="nav-item">Overview</a></li>
                <li><a href="../reports.html" class="nav-item">Reports</a></li>
                <li><a href="datagrid-inquiry.html" class="nav-item active">Datagrid Inquiry</a></li>
            </ul>
        </nav>
    </header>

    <!-- Main content -->
    <main class="dashboard-main main-content">
        <!-- Context bar container -->
        <section id="context-bar-container" class="context-bar-v2" role="banner" aria-label="Dashboard Context"></section>
        <div id="datagrid-inquiry-container">
            <div id="grid-header"></div>

            <!-- Context Banner -->
            <div id="context-banner" class="context-banner">
                <div class="banner-content">
                    <div class="breadcrumb">
                        <a href="../index.html" class="back-link" title="Back to Dashboard">
                            <span class="back-arrow">‚Üê</span>
                        </a>
                        <span>Dashboard</span>
                        <span class="separator">‚Ä∫</span>
                        <span id="source-name">Data Analysis</span>
                        <span class="separator">‚Ä∫</span>
                        <span>Data Analysis</span>
                    </div>
                </div>
            </div>

            <!-- Active Filter Chips -->
            <div id="active-filters" class="filter-chips">
                <!-- Chips added dynamically -->
            </div>

            <!-- Filter Sections Container -->
            <section class="filters-container">
                <!-- Analysis Approach - Tier 1 Filters -->
                <div id="analysis-approach" class="filter-section">
                    <h4>Analysis Approach</h4>
                    <div class="filter-grid">
                        <div class="filter-row">
                            <label for="scope-filter">Scope</label>
                            <select id="scope-filter" class="form-control">
                                <option value="promotion">Promotion</option>
                                <option value="category">Category</option>
                                <option value="store">Store</option>
                            </select>
                        </div>
                        <div class="filter-row">
                            <label for="lens-filter">Lens</label>
                            <select id="lens-filter" class="form-control">
                                <option value="performance">Performance</option>
                                <option value="engagement">Engagement</option>
                                <option value="traffic">Traffic</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Content Filters - Tier 2 -->
                <div class="content-filters">
                <h4>Content Filters</h4>
                <div class="filter-groups-grid">
                    <!-- Categories Filter Group -->
                    <div class="filter-group collapsible">
                        <div class="filter-group-header" data-target="category-filters">
                            <h5>Categories</h5>
                            <span class="count" id="category-count">(0)</span>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="filter-options collapsed" id="category-filters">
                            <div class="checkbox-list">
                                <!-- Checkboxes generated dynamically -->
                            </div>
                        </div>
                    </div>

                    <!-- Deal Types Filter Group -->
                    <div class="filter-group collapsible">
                        <div class="filter-group-header" data-target="deal-type-filters">
                            <h5>Deal Types</h5>
                            <span class="count" id="deal-type-count">(0)</span>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="filter-options collapsed" id="deal-type-filters">
                            <div class="checkbox-list">
                                <label class="checkbox-item">
                                    <input type="checkbox" value="bogo" data-filter="deal-type">
                                    <span class="checkmark"></span>
                                    <span class="label-text">BOGO</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" value="discount" data-filter="deal-type">
                                    <span class="checkmark"></span>
                                    <span class="label-text">Discount %</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" value="fixed-price" data-filter="deal-type">
                                    <span class="checkmark"></span>
                                    <span class="label-text">Fixed Price</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" value="premium" data-filter="deal-type">
                                    <span class="checkmark"></span>
                                    <span class="label-text">Premium</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Size Classes Filter Group -->
                    <div class="filter-group collapsible">
                        <div class="filter-group-header" data-target="size-class-filters">
                            <h5>Size Classes</h5>
                            <span class="count" id="size-class-count">(0)</span>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="filter-options collapsed" id="size-class-filters">
                            <div class="checkbox-list">
                                <label class="checkbox-item">
                                    <input type="checkbox" value="S" data-filter="size-class">
                                    <span class="checkmark"></span>
                                    <span class="label-text">Small (S)</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" value="M" data-filter="size-class">
                                    <span class="checkmark"></span>
                                    <span class="label-text">Medium (M)</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" value="L" data-filter="size-class">
                                    <span class="checkmark"></span>
                                    <span class="label-text">Large (L)</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" value="XL" data-filter="size-class">
                                    <span class="checkmark"></span>
                                    <span class="label-text">Extra Large (XL)</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Position Ranges Filter Group -->
                    <div class="filter-group collapsible">
                        <div class="filter-group-header" data-target="position-range-filters">
                            <h5>Position Ranges</h5>
                            <span class="count" id="position-range-count">(0)</span>
                            <span class="expand-icon">‚ñº</span>
                        </div>
                        <div class="filter-options collapsed" id="position-range-filters">
                            <div class="checkbox-list">
                                <label class="checkbox-item">
                                    <input type="checkbox" value="top" data-filter="position-range">
                                    <span class="checkmark"></span>
                                    <span class="label-text">Top</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" value="upper-mid" data-filter="position-range">
                                    <span class="checkmark"></span>
                                    <span class="label-text">Upper Mid</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" value="lower-mid" data-filter="position-range">
                                    <span class="checkmark"></span>
                                    <span class="label-text">Lower Mid</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" value="bottom" data-filter="position-range">
                                    <span class="checkmark"></span>
                                    <span class="label-text">Bottom</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </section>

            <div id="filter-bar" class="filter-bar">
                <input type="search" id="search-box" class="form-control" placeholder="Search...">
                <button id="clear-filters" class="btn btn-secondary">Clear</button>
                <button id="export-btn" class="btn btn-primary" disabled>Export CSV</button>
                <button id="generate-report-btn" class="btn btn-primary" disabled>Generate Report</button>
                <button id="reset-defaults-btn" class="btn btn-secondary" title="Reset all settings to defaults">Reset Defaults</button>
                <div class="column-settings">
                    <button id="column-settings-btn" class="btn btn-secondary" title="Column Settings">‚öôÔ∏è</button>
                    <div id="column-dropdown" class="column-dropdown" style="display: none;">
                        <div class="dropdown-header">Show/Hide Columns</div>
                        <div id="column-checkboxes" class="column-checkboxes"></div>
                    </div>
                </div>
            </div>
            <div id="grid-container"></div>
            <div id="grid-footer"></div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="../shared/error-handler.js"></script>
    <script src="../mock-data/004-data-extended.js"></script>
    <script src="datagrid.js"></script>

    <!-- Context State Service -->
    <script src="../services/context-state-service.js"></script>

    <!-- Simple Context Bar -->
    <script src="../components/context-bar/simple-context-bar.js"></script>

    <!-- URL Parameter Parsing and Context Setup -->
    <script>
        // Parse URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const source = urlParams.get('source');
        const sort = urlParams.get('sort');
        const filter = urlParams.get('filter');
        const direction = urlParams.get('direction') || 'desc';

        // Console log navigation for debugging
        if (source) {
            console.log('üìä Datagrid Navigation Received:', {
                source: source,
                filter: filter,
                sort: sort,
                direction: direction,
                fullURL: window.location.href
            });
        }

        // Context banner updates are now handled by DataGridComponent.parseUrlContext()
        // Legacy grid-header display for backward compatibility
        if (source) {
            const filterText = filter ? ` (${filter.replace(/-/g, ' ')})` : '';
            const sourceFormatted = source.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            document.getElementById('grid-header').innerHTML =
                `<div class="breadcrumb">Dashboard > ${sourceFormatted}${filterText} > Datagrid Inquiry</div>`;
        }

        // Pass parameters to grid when it's initialized
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize URL synchronization
            if (window.contextStateService) {
                window.contextStateService.initUrlSync();
                console.log('üîó URL synchronization initialized for datagrid inquiry');
            }

            // Initialize Context Bar first
            const contextBarContainer = document.getElementById('context-bar-container');
            if (contextBarContainer) {
                new SimpleContextBar(contextBarContainer);
                console.log('‚úÖ Simple context bar initialized on inquiry page');
            }

            // Wait for grid to be available
            setTimeout(() => {
                if (window.grid) {
                    console.log('üîß Applying URL parameters to grid:', {sort, direction, filter});

                    // Apply sort if specified
                    if (sort) {
                        window.grid.sortConfig = {
                            field: sort,
                            direction: direction
                        };
                        console.log('‚úÖ Sort applied:', window.grid.sortConfig);
                    }

                    // Apply filter context if specified
                    if (filter) {
                        // This could be enhanced to apply specific filters based on the filter parameter
                        // Filter context applied
                    }

                    // Re-render grid with new parameters
                    window.grid.render();
                } else {
                    console.warn('‚ö†Ô∏è Grid not available yet, parameters not applied');
                }
            }, 500);
        });
    </script>
</body>
</html>